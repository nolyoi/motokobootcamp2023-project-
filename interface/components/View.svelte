<script>
import Proposal from "./Proposal.svelte";
import { get } from "svelte/store";
import { daoActor, principal } from "../stores";

async function get_proposals() {
  let dao = get(daoActor);
  console.log(dao);
  if (!dao) {
    return;
  }
  console.log("Principal", principal);
  let res = await dao.get_all_proposals();
  console.log("Proposals", res);
  return res;
}
let promise = get_proposals();
</script>

<div class="text-black">
  {#if $principal}
    {#await promise}
      <p>Loading...</p>
    {:then proposals}
      <div>
        <h1 class="text-black mb-4 text-xl uppercase font-black">Proposals</h1>
        {#each proposals.ok as proposal}
          <Proposal proposal="{proposal}" />
        {/each}
      </div>
    {:catch error}
      <p style="color: red">{error.message}</p>
    {/await}
  {:else}
    <p class="example-disabled">Connect with a wallet to access this example</p>
  {/if}
</div>
